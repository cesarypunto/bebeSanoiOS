//
//  Percentile.swift
//  BebeSano
//
//  Created by César Gutiérrez Tapiador on 1/6/16.
//  Copyright © 2016 César Gutiérrez Tapiador. All rights reserved.
//

import UIKit

class Percentile
{
    
    // MARK: Properties
  
    var heigthTable: [Float:[Double:Int]] = [:] //cm
    var weightTable: [Float:[Double:Int]] = [:] //kg
    
    var gender: Child.EGender
    var weight: Double
    var height: Double
    var months: Float
    var weightPercentile: Int = 0
    var heightPercentile: Int = 0
    
    // MARK: Initialization
    
    init?(birthDate: NSDate, trackDate: NSDate, gender: Child.EGender, weight: Double, height: Double) {
        // Initialize stored properties.

        self.gender = gender
        self.weight = weight
        self.height = height
        self.months = 0
        
        if (trackDate.compare(birthDate) == NSComparisonResult.OrderedAscending) || (weight == 0) || (height == 0) {
            return nil
        }
        
        //Load percentile values
        loadData()
        
        //get child months
        self.months = getMonths(fromDate: birthDate, toDate: trackDate)
        
        var heightRow: [Double:Int]
        heightRow = findRow(heigthTable, value: self.months)
        self.heightPercentile = getPercentile(heightRow, value: self.height)
        
        
        var weightRow: [Double:Int]
        weightRow = findRow(weightTable, value: self.months)
        self.weightPercentile = getPercentile(weightRow, value: self.weight)
        
        
    }
    
    func getMonths(fromDate a: NSDate, toDate b: NSDate) -> Float{
        let calendar = NSCalendar.currentCalendar()
        let components = calendar.components([.Day], fromDate: a, toDate: b, options: [])
        
        return Float(components.day) / 30
    }
    
    func loadData() {
        
        
        if self.gender == Child.EGender.Male{
        //Male
            let _weightTableMale: [Float: [Double: Int]] = [
                0: [2.355450986: 3, 2.773801848: 10, 3.150611082: 25, 3.530203168: 50, 3.879076559: 75, 4.17249339: 90, 4.34029274: 95, 4.446488308: 97],
                0.5: [2.799548641: 3, 3.209510017: 10, 3.597395573: 25, 4.003106424: 50, 4.387422565: 75, 4.718161283: 90, 4.910130108: 95, 5.032624982: 97],
                1.5: [3.614688072: 3, 4.020561446: 10, 4.428872952: 25, 4.879525083: 50, 5.327327567: 75, 5.728152752: 90, 5.967101615: 95, 6.121929103: 97],
                2.5: [4.34234145: 3, 4.754479354: 10, 5.183377547: 25, 5.672888765: 50, 6.175598158: 75, 6.638979132: 90, 6.921119162: 95, 7.106250132: 97],
                3.5: [4.992897896: 3, 5.416802856: 10, 5.866806254: 25, 6.391391982: 50, 6.942217106: 75, 7.460702368: 90, 7.781401145: 95, 7.993878049: 97],
                4.5: [5.575169066: 3, 6.01371624: 10, 6.484969167: 25, 7.041836432: 50, 7.635323002: 75, 8.202193202: 90, 8.556813353: 95, 8.793443663: 97],
                5.5: [6.096775274: 3, 6.551379244: 10, 7.043626918: 25, 7.630425182: 50, 8.262032991: 75, 8.871384112: 90, 9.255614546: 95, 9.51330656: 97],
                6.5: [6.564430346: 3, 7.035656404: 10, 7.548345716: 25, 8.162951035: 50, 8.828786159: 75, 9.47546616: 90, 9.885435743: 95, 10.16135019: 97],
                7.5: [6.984123338: 3, 7.472021438: 10, 8.004398775: 25, 8.644832479: 50, 9.34149038: 75, 10.02101374: 90, 10.45331433: 95, 10.74492376: 97],
                8.5: [7.361236116: 3, 7.865532922: 10, 8.416718775: 25, 9.081119817: 50, 9.805593364: 75, 10.51406421: 90, 10.96573632: 95, 11.27083843: 97],
                9.5: [7.700624405: 3, 8.220839211: 10, 8.789881892: 25, 9.476500305: 50, 10.22612395: 75, 10.96017225: 90, 11.42867623: 95, 11.74538465: 97],
                10.5: [8.006677447: 3, 8.542195484: 10, 9.128109523: 25, 9.835307701: 50, 10.60772151: 75, 11.36445045: 90, 11.84763282: 95, 12.17435729: 97],
                11.5: [8.283364855: 3, 8.833485623: 10, 9.43527941: 25, 10.16153567: 50, 10.9546603: 75, 11.73160184: 90, 12.2276612: 95, 12.56308347: 97],
                12.5: [8.534275028: 3, 9.098245709: 10, 9.714941801: 25, 10.45885399: 50, 11.27087147: 75, 12.06594792: 90, 12.57340193: 95, 12.91645043: 97],
                13.5: [8.762648582: 3, 9.339687673: 10, 9.970337596: 25, 10.7306256: 50, 11.55996332: 75, 12.37145331: 90, 12.88910809: 95, 13.23893338: 97],
                14.5: [8.971407287: 3, 9.560722369: 10, 10.20441778: 25, 10.97992482: 50, 11.82524099: 75, 12.65174864: 90, 13.17867019: 95, 13.53462171: 97],
                15.5: [9.163180317: 3, 9.763981751: 10, 10.41986276: 25, 11.20955529: 50, 12.06972515: 75, 12.91015164: 90, 13.44563963: 95, 13.80724431: 97],
                16.5: [9.340328068: 3, 9.951839998: 10, 10.61910138: 25, 11.4220677: 50, 12.29616991: 75, 13.14968707: 90, 13.6932508: 95, 14.0601935: 97],
                17.5: [9.504964014: 3, 10.12643352: 10, 10.80432929: 25, 11.61977698: 50, 12.50708008: 75, 13.37310558: 90, 13.92444193: 95, 14.29654774: 97],
                18.5: [9.658974787: 3, 10.28967982: 10, 10.97752662: 25, 11.80477902: 50, 12.70472779: 75, 13.58290165: 90, 14.14187481: 95, 14.51909298: 97],
                19.5: [9.804039109: 3, 10.44329524: 10, 11.14047457: 25, 11.9789663: 50, 12.89116805: 75, 13.78133058: 90, 14.34795358: 95, 14.73034312: 97],
                20.5: [9.941644878: 3, 10.58881155: 10, 11.2947714: 25, 12.14404334: 50, 13.06825426: 75, 13.9704249: 90, 14.54484233: 95, 14.93255878: 97],
                21.5: [10.07310549: 3, 10.72759156: 10, 11.44184727: 25, 12.30154103: 50, 13.23765258: 75, 14.15200982: 90, 14.73448194: 95, 15.12776542: 97],
                22.5: [10.19957488: 3, 10.86084353: 10, 11.58297823: 25, 12.45283028: 50, 13.40085582: 75, 14.3277181: 90, 14.91860604: 95, 15.31777023: 97],
                23.5: [10.32206165: 3, 10.98963476: 10, 11.7192993: 25, 12.59913494: 50, 13.55919667: 75, 14.49900418: 90, 15.09875606: 95, 15.50417803: 97],
                24.5: [10.4414422: 3, 11.11490406: 10, 11.85181666: 25, 12.74154396: 50, 13.71386029: 75, 14.6671577: 90, 15.27629562: 95, 15.68840631: 97],
                25.5: [10.55847309: 3, 11.23747341: 10, 11.98141892: 25, 12.88102276: 50, 13.86589625: 75, 14.83331632: 90, 15.45242405: 95, 15.87169941: 97],
                26.5: [10.67380261: 3, 11.35805876: 10, 12.10888759: 25, 13.01842382: 50, 14.0162298: 75, 14.99847794: 90, 15.62818936: 95, 16.05514188: 97],
                27.5: [10.78798156: 3, 11.47727994: 10, 12.23490671: 25, 13.1544966: 50, 14.1656725: 75, 15.16351231: 90, 15.80450043: 95, 16.23967114: 97],
                28.5: [10.90147346: 3, 11.59566994: 10, 12.36007175: 25, 13.28989667: 50, 14.31493214: 75, 15.32917196: 90, 15.98213866: 95, 16.42608957: 97],
                29.5: [11.01466395: 3, 11.7136834: 10, 12.48489772: 25, 13.42519408: 50, 14.46462206: 75, 15.49610261: 90, 16.16176896: 95, 16.61507584: 97],
                30.5: [11.12786972: 3, 11.8317045: 10, 12.60982671: 25, 13.56088113: 50, 14.61526973: 75, 15.66485286: 90, 16.34395024: 95, 16.80719582: 97],
                31.5: [11.24134752: 3, 11.95005435: 10, 12.73523417: 25, 13.69737858: 50, 14.76732387: 75, 15.83588308: 90, 16.52914562: 95, 17.00291386: 97],
                32.5: [11.3552982: 3, 12.06899744: 10, 12.86143776: 25, 13.83504622: 50, 14.9211657: 75, 16.00957526: 90, 16.71773017: 95, 17.2025984: 97],
                33.5: [11.46987977: 3, 12.18874835: 10, 12.98869905: 25, 13.97418199: 50, 15.07710916: 75, 16.18623873: 90, 16.91000241: 95, 17.40653835: 97],
                34.5: [11.58520959: 3, 12.30947723: 10, 13.11723187: 25, 14.1150324: 50, 15.23541179: 75, 16.36611917: 90, 17.10619066: 95, 17.61494698: 97],
                35.5: [11.70137143: 3, 12.43131521: 10, 13.24720657: 25, 14.25779618: 50, 15.3962791: 75, 16.54940494: 90, 17.30646132: 95, 17.8279717: 97],
                36: [11.75978387: 3, 12.49268178: 10, 13.31277633: 25, 14.32994444: 50, 15.47772447: 75, 16.6423691: 90, 17.40816491: 95, 17.93624653: 97]
            ]
            
            let _heigthTableMale: [Float: [Double: Int]] = [
                0: [44.9250977976054: 3, 45.5684090997953: 5, 46.5542930191283: 10, 48.1893738140463: 25, 49.988884079: 50, 51.7712574852631: 75, 53.3615347489539: 90, 54.3072119715771: 95],
                0.5: [47.9781237289086: 3, 48.5580920591964: 5, 49.4578038295636: 10, 50.979188894577: 25, 52.695975301: 50, 54.4405431340853: 75, 56.0344409944283: 90, 56.9990773731045: 95],
                1.5: [52.1985946900997: 3, 52.7261065869033: 5, 53.5536465659792: 10, 54.9791044093995: 25, 56.628428552: 50, 58.3505940783497: 75, 59.9664032927709: 90, 60.9646537916633: 95],
                2.5: [55.2632177988627: 3, 55.7734505006415: 5, 56.5777214480317: 10, 57.9743988163658: 25, 59.608953427: 50, 61.33788093201: 75, 62.9815810038618: 90, 64.0078854888541: 95],
                3.5: [57.7304929347406: 3, 58.2374433948044: 5, 59.0383022664733: 10, 60.4343343865457: 25, 62.077000266: 50, 63.8254260405793: 75, 65.4985800404481: 90, 66.5488903032389: 95],
                4.5: [59.8256861622673: 3, 60.3364690517742: 5, 61.1440960517707: 10, 62.5540884936898: 25, 64.216864104: 50, 65.9913066287385: 75, 67.6940478686016: 90, 68.7653775717319: 95],
                5.5: [61.6638370896265: 3, 62.1826080663385: 5, 63.002959620743: 10, 64.4354633830482: 25, 66.125314898: 50, 67.9293475879754: 75, 69.6612233008438: 90, 70.7512829895234: 95],
                6.5: [63.312242388854: 3, 63.8416613064386: 5, 64.6785365049069: 10, 66.1389573500098: 25, 67.860179904: 50, 69.6957947027878: 75, 71.4560916317014: 90, 72.5630679790426: 95],
                7.5: [64.8139541988347: 3, 65.3558384891164: 5, 66.2118122523828: 10, 67.7037500029861: 25, 69.459084582: 50, 71.3273536202234: 75, 73.1152468262671: 90, 74.2376674565529: 95],
                8.5: [66.1983256978706: 3, 66.7539798471866: 5, 67.6308774877649: 10, 69.1568171782938: 25, 70.948039123: 50, 72.8494700064575: 75, 74.6640975696173: 90, 75.8007440832438: 95],
                9.5: [67.4863482409871: 3, 68.0567455477914: 5, 68.9559062937649: 10, 70.5176063572942: 25, 72.345861109: 50, 74.2806018978287: 75, 76.1211038001601: 90, 77.2709525026483: 95],
                10.5: [68.693603040503: 3, 69.2794921906571: 5, 70.2019246073148: 10, 71.8006481524649: 25, 73.666654103: 50, 75.6346184545689: 75, 77.5001582544642: 90, 78.6623393606722: 95],
                11.5: [69.8320014339409: 3, 70.4339743086492: 5, 71.3804554654194: 10, 73.0171184560636: 25, 74.921297174: 50, 76.9222432757408: 75, 78.8120169668475: 90, 79.9857821808662: 95],
                12.5: [70.9108782371828: 3, 71.5294120412332: 5, 72.5005495820495: 10, 74.1758148300991: 25, 76.118375358: 50, 78.1519584863021: 75, 80.0652015503418: 90, 81.2499031578935: 95],
                13.5: [71.9376972069369: 3, 72.573183808992: 5, 73.5694592157624: 10, 75.2838018914029: 25, 77.264799111: 50, 79.3306066926996: 75, 81.2665956603052: 90, 82.4616686472545: 95],
                14.5: [72.9185302489553: 3, 73.5712963119119: 5, 74.5930947130448: 10, 76.3468477709515: 25, 78.366223087: 50, 80.4637989233865: 75, 82.4218515364754: 90, 83.6268000285099: 95],
                15.5: [73.8583906008274: 3, 74.5287118963997: 5, 75.5763433306313: 10, 77.3697300415551: 25, 79.427340501: 50, 81.5562016910643: 75, 83.5356759291034: 90, 84.7500624094899: 95],
                16.5: [74.7614707523533: 3, 75.4495825856131: 5, 76.5232975362633: 10, 78.3564553342004: 25, 80.452094919: 50, 82.6117438683462: 75, 84.6120363751048: 90, 85.8354730177395: 95],
                17.5: [75.63131645364: 3, 76.3374213958132: 5, 77.4374223484628: 10, 79.3104206167123: 25, 81.443836034: 50, 83.6337690011812: 75, 85.6543131460014: 90, 86.8864547305889: 95],
                18.5: [76.4709562790104: 3, 77.1952300188364: 5, 78.3216802341811: 10, 80.2345338332348: 25, 82.405436434: 50, 84.625149679001: 75, 86.6654134890358: 90, 87.9059515746162: 95],
                19.5: [77.2830000089799: 3, 78.0255958397382: 5, 79.1786261007151: 10, 81.1313057809738: 25, 83.339380627: 50, 85.5883747924065: 75, 87.6478588148759: 90, 88.8965168737897: 95],
                20.5: [78.0697142878296: 3, 78.8307666113033: 5, 80.0104805083643: 10, 82.0029210701211: 25, 84.247833944: 50, 86.5256171998123: 75, 88.6038524153657: 90, 89.8603817616653: 95],
                21.5: [78.8330817172154: 3, 79.612708816061: 5, 80.8191869414724: 10, 82.8512937059361: 25, 85.132696575: 50, 87.4387868475588: 75, 89.5353326608376: 90, 90.7995090121291: 95],
                22.5: [79.5748455580292: 3, 80.3731528544819: 5, 81.6064574952835: 10, 83.6781129605404: 25, 85.995648803: 50, 88.3295747071967: 75, 90.4440154924459: 90, 91.7156346758992: 95],
                23.5: [80.2965565913491: 3, 81.1136348241789: 5, 82.3738080633518: 10, 84.484870913977: 25, 86.838175097: 50, 89.1994789390605: 75, 91.3314274071703: 90, 92.6103075004739: 95],
                24.5: [80.9995872983678: 3, 81.835518175749: 5, 83.1225894944865: 10, 85.2729040435318: 25, 87.661609339: 50, 90.0498454931164: 75, 92.1989349712012: 90, 93.4849087336022: 95],
                25.5: [81.7446395330885: 3, 82.581353443818: 5, 83.8724497800876: 10, 86.0370290207216: 25, 88.452472817: 50, 90.8787005572373: 75, 93.0714335250574: 90, 94.3877452248001: 95],
                26.5: [82.4736527307001: 3, 83.3110528286648: 5, 84.6057624632736: 10, 86.7832934580158: 25, 89.223264339: 50, 91.6846760256571: 75, 93.9181746482636: 90, 95.2630007597693: 95],
                27.5: [83.188122057027: 3, 84.0260900564991: 5, 85.3239891157348: 10, 87.5131740027243: 25, 89.975492278: 50, 92.4692889214632: 75, 94.7406366331136: 90, 96.1121011988834: 95],
                28.5: [83.8893068413842: 3, 84.7276916167264: 5, 86.0283299569244: 10, 88.227875866497: 25, 90.710408526: 50, 93.2338474937995: 75, 95.5401622624724: 90, 96.9363947623564: 95],
                29.5: [84.5782638893427: 3, 85.4168802715866: 5, 86.7197799432531: 10, 88.9284011706542: 25, 91.429077621: 50, 93.9795084259939: 75, 96.3179956489321: 90, 97.7371728943947: 95],
                30.5: [85.2558869161821: 3, 86.0945174468316: 5, 87.3991747668398: 10, 89.6155978698257: 25, 92.132423789: 50, 94.7073165354158: 75, 97.0753111049134: 90, 98.5156910420506: 95],
                31.5: [85.9229395984847: 3, 86.7613389249827: 5, 88.0672298826861: 10, 90.2902017684162: 25, 92.821271673: 50, 95.4182388451418: 75, 97.8132366010555: 90, 99.2731837770055: 95],
                32.5: [86.5800851110585: 3, 87.4179858742151: 5, 88.7245734534635: 10, 90.9528710722229: 25, 93.496379457: 50, 96.1131921689973: 75, 98.5328725420431: 90, 100.010876547669: 95],
                33.5: [87.2279127412898: 3, 88.0650320338: 5, 89.3717742721354: 10, 91.6042146714144: 25, 94.158465459: 50, 96.7930650441201: 75, 99.2353065322745: 90, 100.729994719356: 95],
                34.5: [87.8669617158391: 3, 88.7030074483648: 5, 90.0093653632044: 10, 92.2448151465021: 25, 94.808229231: 50, 97.4587349014246: 75, 99.9216248249548: 90, 101.431770491437: 95],
                35.5: [88.4977409604969: 3, 89.3324183664647: 5, 90.6378640422833: 10, 92.8752486107173: 25, 95.446369813: 50, 98.1110826134703: 75, 100.592921223266: 90, 102.117447218662: 95]
            ]
            self.weightTable = _weightTableMale
            self.heigthTable = _heigthTableMale
            
        }else{
        //Female
            let _weightTableFemale: [Float: [Double: Int]] = [
                0: [2.414111983: 3, 2.747222257: 10, 3.06486465: 25, 3.39918645: 50, 3.717519384: 75, 3.992572231: 90, 4.152636594: 95, 4.254922004: 97],
                0.5: [2.756916984: 3, 3.101767067: 10, 3.437628263: 25, 3.79752846: 50, 4.145593668: 75, 4.450125603: 90, 4.628836382: 95, 4.743581789: 97],
                1.5: [3.402293298: 3, 3.770157472: 10, 4.13899376: 25, 4.544776513: 50, 4.946765504: 75, 5.305632496: 90, 5.51916925: 95, 5.657379108: 97],
                2.5: [3.997805608: 3, 4.387041982: 10, 4.784820426: 25, 5.230584214: 50, 5.680083196: 75, 6.08764077: 90, 6.332837055: 95, 6.492574414: 97],
                3.5: [4.54738333: 3, 4.95592631: 10, 5.379141034: 25, 5.859960798: 50, 6.351511983: 75, 6.802769825: 90, 7.076722522: 95, 7.256165568: 97],
                4.5: [5.054538727: 3, 5.480295205: 10, 5.92588831: 25, 6.437587751: 50, 6.966523789: 75, 7.45711879: 90, 7.757233948: 95, 7.954730061: 97],
                5.5: [5.522500226: 3, 5.963510428: 10, 6.428828208: 25, 6.967850457: 50, 7.53018045: 75, 8.056331004: 90, 8.380329759: 95, 8.59441348: 97],
                6.5: [5.954272494: 3, 6.408775097: 10, 6.891533095: 25, 7.454854109: 50, 8.047178246: 75, 8.605635546: 90, 8.951543685: 95, 9.180938407: 97],
                7.5: [6.352668277: 3, 6.819122283: 10, 7.317373091: 25, 7.902436186: 50, 8.52187726: 75, 9.109878097: 90, 9.476008728: 95, 9.719620693: 97],
                8.5: [6.720327734: 3, 7.197413532: 10, 7.709516114: 25, 8.314178377: 50, 8.958324062: 75, 9.573546299: 90, 9.958479736: 95, 10.2153883: 97],
                9.5: [7.059731719: 3, 7.546341788: 10, 8.070932165: 25, 8.693418423: 50, 9.360270982: 75, 10.00079194: 90, 10.40335475: 95, 10.67280092: 97],
                10.5: [7.373211901: 3, 7.868436369: 10, 8.404399764: 25, 9.043261854: 50, 9.7311934: 75, 10.3954511: 90, 10.81469528: 95, 11.0960696: 97],
                11.5: [7.662959063: 3, 8.166068895: 10, 8.712513432: 25, 9.366593571: 50, 10.07430572: 75, 10.76106284: 90, 11.19624565: 95, 11.48907597: 97],
                12.5: [7.93103031: 3, 8.441459662: 10, 8.997691667: 25, 9.666089185: 50, 10.39257636: 75, 11.10088678: 90, 11.5514514: 95, 11.85539095: 97],
                13.5: [8.179355552: 3, 8.696684147: 10, 9.262185089: 25, 9.944226063: 50, 10.68874201: 75, 11.4179197: 90, 11.88347697: 95, 12.19829279: 97],
                14.5: [8.409743555: 3, 8.933679535: 10, 9.508084539: 25, 10.20329397: 50, 10.96532105: 75, 11.7149113: 90, 12.19522253: 95, 12.52078451: 97],
                15.5: [8.62388725: 3, 9.154251142: 10, 9.737329319: 25, 10.4454058: 50, 11.2246268: 75, 11.99437938: 90, 12.48934: 95, 12.82561033: 97],
                16.5: [8.82336957: 3, 9.360078736: 10, 9.951714686: 25, 10.67250698: 50, 11.46877937: 75, 12.258624: 90, 12.76824867: 95, 13.11527219: 97],
                17.5: [9.00966812: 3, 9.55272268: 10, 10.15289979: 25, 10.88638558: 50, 11.69971783: 75, 12.50974133: 90, 13.03414978: 95, 13.39204468: 97],
                18.5: [9.184160166: 3, 9.733629905: 10, 10.34241498: 25, 11.08868151: 50, 11.91921144: 75, 12.74963667: 90, 13.28904061: 95, 13.65798985: 97],
                19.5: [9.348127323: 3, 9.904139709: 10, 10.52166904: 25, 11.28089537: 50, 12.1288704: 75, 12.98003694: 90, 13.53472797: 95, 13.91497124: 97],
                20.5: [9.502760074: 3, 10.06548937: 10, 10.69195601: 25, 11.46439708: 50, 12.3301562: 75, 13.20250263: 90, 13.77284102: 95, 14.1646673: 97],
                21.5: [9.649162144: 3, 10.21881956: 10, 10.85446195: 25, 11.64043402: 50, 12.52439148: 75, 13.41843913: 90, 14.00484351: 95, 14.40858419: 97],
                22.5: [9.788354721: 3, 10.3651796: 10, 11.01027128: 25, 11.81013895: 50, 12.71276942: 75, 13.62910755: 90, 14.23204547: 95, 14.64806798: 97],
                23.5: [9.921280547: 3, 10.50553251: 10, 11.16037297: 25, 11.97453748: 50, 12.89636272: 75, 13.8356351: 90, 14.45561433: 95, 14.88431632: 97],
                24.5: [10.04880788: 3, 10.64075987: 10, 11.30566645: 25, 12.13455528: 50, 13.07613212: 75, 14.03902484: 90, 14.67658549: 95, 15.11838945: 97],
                25.5: [10.17173431: 3, 10.77166654: 10, 11.44696728: 25, 12.2910249: 50, 13.25293459: 75, 14.24016506: 90, 14.89587242: 95, 15.35122083: 97],
                26.5: [10.29079052: 3, 10.89898515: 10, 11.58501256: 25, 12.44469237: 50, 13.42753102: 75, 14.43983817: 90, 15.11427618: 95, 15.5836271: 97],
                27.5: [10.40664383: 3, 11.02338047: 10, 11.72046615: 25, 12.59622335: 50, 13.60059358: 75, 14.63872906: 90, 15.33249457: 95, 15.8163176: 97],
                28.5: [10.51990171: 3, 11.14545358: 10, 11.8539236: 25, 12.74620911: 50, 13.77271274: 75, 14.83743314: 90, 15.55113065: 95, 16.0499034: 97],
                29.5: [10.63111516: 3, 11.26574591: 10, 11.98591692: 25, 12.89517218: 50, 13.94440383: 75, 15.03646393: 90, 15.770701: 95, 16.28490586: 97],
                30.5: [10.74078194: 3, 11.38474303: 10, 12.11691911: 25, 13.04357164: 50, 14.11611337: 75, 15.23626013: 90, 15.99164336: 95, 16.52176469: 97],
                31.5: [10.84934975: 3, 11.50287842: 10, 12.24734843: 25, 13.19180827: 50, 14.28822496: 75, 15.43719248: 90, 16.21432393: 95, 16.7608456: 97],
                32.5: [10.95721927: 3, 11.62053697: 10, 12.37757256: 25, 13.34022934: 50, 14.46106492: 75, 15.63957012: 90, 16.43904429: 95, 17.00244749: 97],
                33.5: [11.06474677: 3, 11.73805834: 10, 12.50791269: 25, 13.48913357: 50, 14.634908: 75, 15.84364677: 90, 16.66604772: 95, 17.24680884: 97],
                34.5: [11.17224778: 3, 11.85574032: 10, 12.63864672: 25, 13.63877446: 50, 14.80998135: 75, 16.04962601: 90, 16.89552564: 95, 17.49411514: 97],
                35.5: [11.27999893: 3, 11.9738418: 10, 12.77001339: 25, 13.78936547: 50, 14.98647034: 75, 16.25766706: 90, 17.12762297: 95, 17.74450372: 97],
                36: [11.33404488: 3, 12.03312087: 10, 12.83599859: 25, 13.86507382: 50, 15.07529315: 75, 16.36249956: 90, 17.24468787: 95, 17.87088515: 97]
            ]
            
            let _heigthTableFemale: [Float: [Double: Int]] = [
                0: [45.0948826086757: 3, 45.5756074032262: 5, 46.33933651097: 10, 47.6834546897351: 25, 49.286396118: 50, 51.0186957374673: 75, 52.7025011515363: 90, 53.7729087781385: 95],
                0.5: [47.4691579210798: 3, 47.9632397723035: 5, 48.7424816756963: 10, 50.0968551349334: 25, 51.683580573: 50, 53.3636233876347: 75, 54.9622227613846: 90, 55.9609422583569: 95],
                1.5: [50.9570056178233: 3, 51.4799569019402: 5, 52.2962687115733: 10, 53.6907813798356: 25, 55.286128126: 50, 56.9313607669117: 75, 58.4561236882012: 90, 59.3891073401307: 95],
                2.5: [53.6292529172354: 3, 54.1790736390626: 5, 55.0314430575534: 10, 56.471252168873: 25, 58.093819061: 50, 59.7404469372429: 75, 61.2430575079682: 90, 62.1516557869816: 95],
                3.5: [55.8593993638303: 3, 56.4333494737886: 5, 57.3189243814216: 10, 58.803462078233: 25, 60.459807634: 50, 62.1232951300098: 75, 63.6264785034804: 90, 64.5287532586929: 95],
                4.5: [57.8047010891317: 3, 58.4003243697912: 5, 59.3163276815511: 10, 60.843862287441: 25, 62.536696555: 50, 64.2250712719925: 75, 65.7409589481044: 90, 66.6465255567482: 95],
                5.5: [59.5479929662389: 3, 60.1632307548084: 5, 61.1072583629727: 10, 62.6758970949149: 25, 64.406327624: 50, 66.1241785195238: 75, 67.6599521762148: 90, 68.5745160669867: 95],
                6.5: [61.1389312239288: 3, 61.7720801452771: 5, 62.7421028311681: 10, 64.3500534414942: 25, 66.118415533: 50, 67.8684993704711: 75, 69.4286842451886: 90, 70.3558690749937: 95],
                7.5: [62.6099317860152: 3, 63.2595795382136: 5, 64.2538878034357: 10, 65.8995209587227: 25, 67.705744192: 50, 69.4897495002519: 75, 71.077310633283: 90, 72.0195245465041: 95],
                8.5: [63.9834808678867: 3, 64.648448283892: 5, 65.6655938984631: 10, 67.3474459293245: 25, 69.191236138: 50, 71.0101890533948: 75, 72.6271149509581: 90, 73.5860080640044: 95],
                9.5: [65.275903473378: 3, 65.9551975697399: 5, 66.9939437112267: 10, 68.710701883648: 25, 70.591639237: 50, 72.4461366949443: 75, 74.0937751240296: 90, 75.0705008752525: 95],
                10.5: [66.4994793475434: 3, 67.1922564646481: 5, 68.2515376575953: 10, 70.0020216928785: 25, 71.919616727: 50, 73.8099684773972: 75, 75.4892312988745: 90, 76.4846049480161: 95],
                11.5: [67.6637114610333: 3, 68.3692485504204: 5, 69.4481390536453: 10, 71.2312834164726: 25, 73.185010399: 50, 75.1113294629031: 75, 76.8228234514385: 90, 77.8374228517723: 95],
                12.5: [68.7761269376622: 3, 69.4937991670582: 5, 70.591488102113: 10, 72.4063263933377: 25, 74.395643786: 50, 76.3579061719386: 75, 78.1020197343567: 90, 79.1362519137182: 95],
                13.5: [69.8428047380368: 3, 70.5720679121745: 5, 71.6878395982049: 10, 73.5334911968798: 25, 75.557854397: 50, 77.5559396350042: 75, 79.3329020440415: 90, 80.3870485957959: 95],
                14.5: [70.8687355489754: 3, 71.6091122237936: 5, 72.742330546318: 10, 74.6179893515629: 25, 76.676858713: 50, 78.7105780499221: 75, 80.5205009757141: 90, 81.5947498562919: 95],
                15.5: [71.8580748144161: 3, 72.6091432273851: 5, 73.7592390943967: 10, 75.6641640294465: 25, 77.757009856: 50, 79.8261262130668: 75, 81.6690334451603: 90, 82.7635017421482: 95],
                16.5: [72.8143250204203: 3, 73.5757102067571: 5, 74.7421714181467: 10, 76.6756784417595: 25, 78.801984056: 50, 80.9062264064347: 75, 82.782075541617: 90, 83.8968261114336: 95],
                17.5: [73.7404700649121: 3, 74.5118366642775: 5, 75.6941996522115: 10, 77.6556549949202: 25, 79.814918523: 50, 81.9539923653731: 75, 83.8626908671008: 90, 84.9977446900603: 95],
                18.5: [74.6390761233502: 3, 75.4201225170942: 5, 76.6179655680007: 10, 78.6067799947587: 25, 80.798515316: 50, 82.9721103965001: 75, 84.9135276607395: 90, 86.0688731589567: 95],
                19.5: [75.5123687493777: 3, 76.3028222430392: 5, 77.5157598866749: 10, 79.5313837937216: 25, 81.755120921: 50, 83.9629169618863: 75, 85.9368934784343: 90, 87.1124936280132: 95],
                20.5: [76.3622926251531: 3, 77.161905465163: 5, 78.3895838006527: 10, 80.4315030102563: 25, 82.686788098: 50, 84.9284590774354: 75, 86.9348134608792: 90, 88.1306112849774: 95],
                21.5: [77.1905585396518: 3, 77.9991045975868: 5, 79.2411973726709: 10, 81.3089295059433: 25, 83.59532461: 50, 85.8705419695333: 75, 87.9090763999459: 90, 89.1249992524607: 95],
                22.5: [77.9986807194647: 3, 78.8159527193617: 5, 80.0721580274065: 10, 82.1652493713631: 25, 84.48233206: 50, 86.7907671238583: 75, 88.861271598425: 90, 90.0972345401269: 95],
                23.5: [78.7880078334209: 3, 79.6138145644373: 5, 80.8838514673423: 10, 83.0018736150738: 25, 85.349236238: 50, 87.6905622578691: 75, 89.7928185194043: 90, 91.0487275197954: 95],
                24.5: [79.5597432560035: 3, 80.3939091825267: 5, 81.6775173224022: 10, 83.8200669785362: 25, 86.197316902: 50, 88.5712095309212: 75, 90.7049915253405: 90, 91.980743693395: 95],
                25.5: [80.3399836447861: 3, 81.1880425327028: 5, 82.4931841293221: 10, 84.6720881213213: 25, 87.090263184: 50, 89.5056243790664: 75, 91.6771799476171: 90, 92.9757373133401: 95],
                26.5: [81.1133152483163: 3, 81.9722292694881: 5, 83.2945896917198: 10, 85.5036023508396: 25, 87.957141816: 50, 90.409819647466: 75, 92.6165822490131: 90, 93.9369267310196: 95],
                27.5: [81.873342777578: 3, 82.7408446834455: 5, 84.0771733221153: 10, 86.3115062063632: 25, 88.796018399: 50, 91.2825803646764: 75, 93.5222656486659: 90, 94.8633893451586: 95],
                28.5: [82.6150644716935: 3, 83.489507360581: 5, 84.8374122236475: 10, 87.0934589510975: 25, 89.605511504: 50, 92.1231313812475: 75, 94.3937145442226: 90, 95.754640882198: 95],
                29.5: [83.3347329303371: 3, 84.214958896625: 5, 85.5727280648047: 10, 87.8478269972245: 25, 90.38476689: 50, 92.9311262420439: 75, 95.2308178950554: 90, 96.6106146313602: 95],
                30.5: [84.0297181712464: 3, 84.9149438923273: 5, 86.2813902686523: 10, 88.5736188166774: 25, 91.133417221: 50, 93.7066211970039: 75, 96.0338473177221: 90, 97.4316380574577: 95],
                31.5: [84.698367159698: 3, 85.5880888605943: 5, 86.9624207755768: 10, 89.2704228999176: 25, 91.851543603: 50, 94.4500478190715: 75, 96.8034300986108: 90, 98.2184020761176: 95],
                32.5: [85.339869204126: 3, 86.2337857228041: 5, 87.6155015785346: 10, 89.9383458987549: 25, 92.539635196: 50, 95.1621825659166: 75, 97.5405191361178: 90, 98.971927774104: 95],
                33.5: [85.9541339909327: 3, 86.8520842736115: 5, 88.2408864772002: 10, 90.5779493515219: 25, 93.198544285: 50, 95.8441117544952: 75, 98.2463607452525: 90, 99.693533549472: 95],
                34.5: [86.5416687989135: 3, 87.4435872314188: 5, 88.8393197753093: 10, 91.1901980158248: 25, 93.829453915: 50, 96.4972051892791: 75, 98.9224631324983: 90, 100.384796022932: 95],
                35.5: [87.1034887423911: 3, 88.0093655358739: 5, 89.4119588419568: 10, 91.7763934746218: 25, 94.433822779: 50, 97.1230720411817: 75, 99.5705625418812: 90, 101.047522729371: 95]
            ]
            self.weightTable = _weightTableFemale
            self.heigthTable = _heigthTableFemale
        }
        
        
    }
    
    
    
    //MARK: Methods
    func getPercentile(Row: [Double:Int], value: Double) -> Int{
        //sorted array in order to get a faster search
        let sortedKeys = Array(Row.keys).sort(<)
        
        var prevItem: Double = 0.0
        var firstElement: Bool = true
        
        for key in sortedKeys{
            if value == key{
                return Row[key]!
            } else if value < key{
                if firstElement{
                    return 3 //value is lower than first element
                }else{
                    let lowPercentile: Int = Row[prevItem]!
                    let highPercentile: Int = Row[key]!
                    let distance: Int = highPercentile - lowPercentile
                    let increase: Double = (key - prevItem) / Double(distance)
                    
                    var calculateKey: Double = prevItem
                    for i in 1 ..< distance {
                        calculateKey = calculateKey + increase
                        
                        if value == calculateKey{
                            return Row[prevItem]! + i
                        } else if value < calculateKey{
                            return Row[prevItem]! + i - 1
                        }
                    }
                }
            }
            
            
            firstElement = false
            prevItem = key
        }
        
        
        return Row[prevItem]! //Last percentile
    }
    
    
    //Find child month
    func findRow(Table: [Float:[Double:Int]], value: Float) -> [Double:Int]{
        
        //sorted array in order to get a faster search
        let sortedKeys = Array(Table.keys).sort(<)
        
        var prevItem: Float = 0.0
        
        for key in sortedKeys{
           
            if value == key{
                return Table[key]!
            } else if key > value{ //Get the lower value
               return Table[prevItem]!
            }

             prevItem = key
        }
        //Get the last value
        return Table[prevItem]!
    }
    
    
}